<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Membros</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    
</head>
<body>
    <img src="logo-azul-vertical.png" alt="Imagem no topo" class="top-image">
    <h1 class="form-title">Formulário de Atualização Cadastral</h1>

    <!-- Input para carregar o arquivo Excel -->
    <input type="file" id="fileInput" onchange="carregarPlanilha(event)" class="input_form"><br><br>

    <!-- Campo de seleção para escolher o membro -->
    <div class="field">
        <label for="selecionarMembro">Selecione um Membro:</label>
        <select id="selecionarMembro" onchange="preencherCampos()">
            <option value="">Escolha um nome</option>
        </select>
    </div>

    <!-- Formulário -->
    <form id="funcionarioForm">
        <!-- Dados Pessoais -->
        <label for="assunto" class="section-title">Dados Pessoais:</label>
        <div class="form-group_pessoal">
            <!-- Nome -->
            <div class="field">
                <label for="nome">Nome:</label>
                <input type="text" id="nome">
            </div>

            <!-- Sexo -->
            <div class="field">
                <label>Sexo:</label>
                <div class="radio-group">
                    <div>
                        <input type="radio" id="masculino" name="sexo" value="masculino">
                        <label for="masculino">Masculino</label>
                    </div>
                    <div>
                        <input type="radio" id="feminino" name="sexo" value="feminino">
                        <label for="feminino">Feminino</label>
                    </div>
                </div>
            </div>

            <!-- Grau de Instrução e Formação -->
            <div class="instrucao-formacao">
                <div class="field">
                    <label for="grau_instrucao">Grau de Instrução:</label>
                    <input type="text" id="grau_instrucao">
                </div>
                <div class="field">
                    <label for="formacao">Formação:</label>
                    <input type="text" id="formacao">
                </div>
            </div>

            <!-- É Empresário e Profissão -->
            <div class="empresario-profissao">
                <div class="field">
                    <label for="empresario">É Empresário?</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="empresario_sim" name="empresario" value="sim">
                            <label for="empresario_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="empresario_nao" name="empresario" value="nao">
                            <label for="empresario_nao">Não</label>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="profissao">Profissão/Atividade Comercial:</label>
                    <input type="text" id="profissao">
                </div>
            </div>

            <!-- CPF, RG e SSP -->
            <div class="documentos">
                <div class="field">
                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf">
                </div>
                <div class="field">
                    <label for="rg">RG:</label>
                    <input type="text" id="rg">
                </div>
               
            </div>

            <!-- Naturalidade e Nacionalidade -->
            <div class="naturalidade-nacionalidade">
                <div class="field">
                    <label for="naturalidade">Naturalidade:</label>
                    <input type="text" id="naturalidade">
                </div>
                <div class="field">
                    <label for="nacionalidade">Nacionalidade:</label>
                    <input type="text" id="nacionalidade">
                </div>
            </div>

            <!-- Data de Nascimento e Estado Civil -->
            <div class="nascimento-estado-civil">
                <div class="field">
                    <label for="data_nascimento">Data de Nascimento:</label>
                    <input type="text" id="data_nascimento">
                </div>
                <div class="field">
                    <label for="estado_civil">Estado Civil:</label>
                    <input type="text" id="estado_civil">
                </div>
            </div>

            <!-- Nome do Cônjuge -->
            <div class="field">
                <label for="nome_conjuge" style="font-size: 14px; color: #333; margin-top: 10px;">Se Casado:</label>
                <input type="text" id="nome_conjuge">
            </div>

            <!-- Data de Casamento e Membro Casado -->
            <div class="conjuge-casamento">
                <div class="field">
                    <label for="data_casamento">Data do Casamento:</label>
                    <input type="text" id="data_casamento">
                </div>
                <div class="field">
                    <label>Cônjunge é membro?</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="membro_casado_sim" name="membro_casado" value="sim">
                            <label for="membro_casado_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="membro_casado_nao" name="membro_casado" value="nao">
                            <label for="membro_casado_nao">Não</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Endereço -->
            <div class="field">
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco">
            </div>

            <!-- Cidade e Bairro -->
            <div class="endereco-cidade-bairro">
                <div class="field">
                    <label for="cidade">Cidade:</label>
                    <input type="text" id="cidade">
                </div>
                <div class="field">
                    <label for="bairro">Bairro:</label>
                    <input type="text" id="bairro">
                </div>
            </div>

            <!-- Número, Estado, País e CEP -->
            <div class="numero-estado-pais-cep">
                <div class="field">
                    <label for="numero">Número:</label>
                    <input type="text" id="numero">
                </div>
                <div class="field">
                    <label for="estado">Estado:</label>
                    <input type="text" id="estado">
                </div>
                <div class="field">
                    <label for="pais">País:</label>
                    <input type="text" id="pais">
                </div>
                <div class="field">
                    <label for="cep">CEP:</label>
                    <input type="text" id="cep">
                </div>
            </div>

            <!-- Telefone 1 e Operadora -->
            <div class="telefone-operadora">
                <div class="field">
                    <label for="telefone1">Telefone 1:</label>
                    <input type="text" id="telefone1">
                </div>
                <div class="field">
                    <label>WhatsApp?</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="whatsapp1_sim" name="whatsapp1" value="sim">
                            <label for="whatsapp1_sim">Sim</label>
                        </div>
                        
                    </div>
                </div>
                <div class="field">
                    <label for="operadora1">Operadora:</label>
                    <input type="text" id="operadora1">
                </div>
            </div>

            <!-- Telefone 2 e Operadora -->
            <div class="telefone-operadora">
                <div class="field">
                    <label for="telefone2">Telefone 2:</label>
                    <input type="text" id="telefone2">
                </div>
                <div class="field">
                    <label>WhatsApp?</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="whatsapp2_sim" name="whatsapp2" value="sim">
                            <label for="whatsapp2_sim">Sim</label>
                        </div>
                        
                    </div>
                </div>
                <div class="field">
                    <label for="operadora2">Operadora:</label>
                    <input type="text" id="operadora2">
                </div>
            </div>

            <!-- Email -->
            <div class="field">
                <label for="email">E-mail:</label>
                <input type="email" id="email" style="height: 35px;">
            </div>

            <!-- Dependentes -->
            <div class="dependentes">
                <div class="field">
                    <label for="dependente1">Nome do 1º Dependente:</label>
                    <input type="text" id="dependente1">
                </div>
                <div class="field">
                    <label for="data_nascimento_dependente1">Data de Nascimento do 1º Dependente:</label>
                    <input type="text_data" id="data_nascimento_dependente1">
                </div>
            </div>
            <div class="dependentes">
                <div class="field">
                    <label for="dependente2">Nome do 2º Dependente:</label>
                    <input type="text" id="dependente2">
                </div>
                <div class="field">
                    <label for="data_nascimento_dependente2">Data de Nascimento do 2º Dependente:</label>
                    <input type="text_data" id="data_nascimento_dependente2">
                </div>
            </div>
            <div class="dependentes">
                <div class="field">
                    <label for="dependente3">Nome do 3º Dependente:</label>
                    <input type="text" id="dependente3">
                </div>
                <div class="field">
                    <label for="data_nascimento_dependente3">Data de Nascimento do 3º Dependente:</label>
                    <input type="text_data" id="data_nascimento_dependente3">
                </div>
            </div>
            <div class="dependentes">
                <div class="field">
                    <label for="dependente4">Nome do 4º Dependente:</label>
                    <input type="text" id="dependente4">
                </div>
                <div class="field">
                    <label for="data_nascimento_dependente4">Data de Nascimento do 4º Dependente:</label>
                    <input type="text_data" id="data_nascimento_dependente4">
                </div>
            </div>

            <!-- Rhema/EMR/ERMM -->
            <div class="rhema-emr-ermm">
                <div class="field">
                    <label>Rhema:</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="rhema_sim" name="rhema" value="sim">
                            <label for="rhema_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="rhema_nao" name="rhema" value="nao">
                            <label for="rhema_nao">Não</label>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="data_conclusao_rhema">Ano de Conclusão do Rhema:</label>
                    <input type="text_rhema" id="data_conclusao_rhema">
                </div>
            </div>
            <div class="rhema-emr-ermm">
                <div class="field">
                    <label>EMR:</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="emr_sim" name="emr" value="sim">
                            <label for="emr_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="emr_nao" name="emr" value="nao">
                            <label for="emr_nao">Não</label>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="data_conclusao_emr">Ano de Conclusão da EMR:</label>
                    <input type="text_rhema" id="data_conclusao_emr">
                </div>
            </div>
            <div class="rhema-emr-ermm">
                <div class="field">
                    <label>ERMM:</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="ermm_sim" name="ermm" value="sim">
                            <label for="ermm_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="ermm_nao" name="ermm" value="nao">
                            <label for="ermm_nao">Não</label>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="data_conclusao_ermm">Ano de Conclusão da ERMM:</label>
                    <input type="text_rhema" id="data_conclusao_ermm">
                </div>
            </div>

            <!-- Batismo e Espírito Santo -->
            <div class="batismo-espirito">
                <div class="field">
                    <label for="data_novo_nascimento">Data do Novo Nascimento:</label>
                    <input type="text_data" id="data_novo_nascimento">
                </div>
                <div class="field">
                    <label>Já recebeu o Espírito Santo?</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="espirito_santo_sim" name="espirito_santo" value="sim">
                            <label for="espirito_santo_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="espirito_santo_nao" name="espirito_santo" value="nao">
                            <label for="espirito_santo_nao">Não</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Batismo nas Águas -->
            <div class="batismo-espirito">
                <div class="field">
                    <label>Batismo nas Águas:</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="batismo_aguas_sim" name="batismo_aguas" value="sim">
                            <label for="batismo_aguas_sim">Sim</label>
                        </div>
                        <div>
                            <input type="radio" id="batismo_aguas_nao" name="batismo_aguas" value="nao">
                            <label for="batismo_aguas_nao">Não</label>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>Forma de Batismo:</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="aspersao" name="forma_batismo" value="aspersao">
                            <label for="aspersao">Aspersão</label>
                        </div>
                        <div>
                            <input type="radio" id="imersao" name="forma_batismo" value="imersao">
                            <label for="imersao">Imersão</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Redes Sociais -->
            <div class="redes-sociais">
                <div class="field">
                    <label for="facebook">Facebook:</label>
                    <input type="text" id="facebook">
                </div>
                <div class="field">
                    <label for="instagram">Instagram:</label>
                    <input type="text" id="instagram">
                </div>
            </div>

            <!-- Observações -->
            <div class="field">
                <label for="observacoes">Observações:</label>
                <textarea id="observacoes"></textarea>
            </div>
        </div>

        <!-- Linha de assinatura -->
    <!-- Adicione isto antes do </form> -->
<div class="assinatura-container" style="margin: 60px 0 30px 0; text-align: center;">
    <div style="margin-bottom: 45px; font-size: 14px;">
        Confirmo que estes dados estão corretos
    </div>
    <div>

    </div>
    <div style="border-top: 1px solid #000; width: 300px; margin: 0 auto; padding-top: 5px;">
        <!-- Aqui aparecerá o nome do membro -->
        <div id="nome-assinatura" style="font-weight: bold; margin-top: 5px;"></div>
    </div>
    
    
</div>
    </form>

    <!-- Script de leitura do arquivo -->
    <script>
        let membersData = [];
        
        function carregarPlanilha(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    membersData = XLSX.utils.sheet_to_json(worksheet, { raw: false });
                    
                    const select = document.getElementById('selecionarMembro');
                    
                    // SOLUÇÃO DEFINITIVA - Recriando completamente o select
                    const novoSelect = select.cloneNode(false); // Clona sem os filhos
                    novoSelect.innerHTML = '<option value="">-- Selecione um membro --</option>';
                    
                    membersData.forEach((member, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = member['Nome '] || member['Nome'] || `Membro ${index+1}`;
                        option.style.color = '#000000'; // Garante texto preto
                        novoSelect.appendChild(option);
                    });
                    
                    // Substitui o select antigo pelo novo
                    select.parentNode.replaceChild(novoSelect, select);
                    novoSelect.id = 'selecionarMembro'; // Mantém o ID
                    novoSelect.disabled = false;
                    
                    // Reatacha o event listener
                    novoSelect.addEventListener('change', preencherCampos);
                    
                    // DEBUG FINAL
                    console.log('Select após atualização:', novoSelect);
                    console.log('Opções disponíveis:', novoSelect.options);
                    
                } catch (error) {
                    console.error("Erro:", error);
                    alert("Erro ao processar arquivo. Verifique o console.");
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
       function formatarData(data) {
                    if (!data) return '';
                
                    const dt = new Date(data);
                    if (isNaN(dt.getTime())) return data; // Retorna a data original se não for válida
                
                    // Formata para DD/MM/YYYY
                    const dia = String(dt.getDate()).padStart(2, '0');
                    const mes = String(dt.getMonth() + 1).padStart(2, '0'); // Mês começa em 0 no JS
                    const ano = dt.getFullYear();
                
                    return `${dia}/${mes}/${ano}`;
        }

       
        function preencherCampos() {
            const selectedIndex = document.getElementById('selecionarMembro').value;
            if (selectedIndex === "") return;
            
            const membro = membersData[selectedIndex];
            console.log("Membro selecionado:", membro); // Para debug
            
            // Mapeamento dos campos - ajustado para sua planilha
            // Campos básicos
            document.getElementById('nome').value = membro['Nome '] || membro['Nome'] || '';
            document.getElementById('cpf').value = membro['CPF'] || '';
            document.getElementById('rg').value = membro['RG'] || '';
            document.getElementById('naturalidade').value = membro['Naturalidade'] || '';
            document.getElementById('nacionalidade').value = membro['Nacionalidade'] || '';
            document.getElementById('pais').value = membro['País'] || 'Brasil';
            document.getElementById('data_nascimento').value = formatarData(membro['Data de Nascimento'] || '');
            document.getElementById('grau_instrucao').value = membro['Escolaridade'] || '';
            document.getElementById('estado_civil').value = membro['Estado Civil'] || '';
            document.getElementById('nome_conjuge').value = membro['Nome do cônjuge'] || '';
            document.getElementById('data_casamento').value = formatarData(membro['Data de Casamento'] || '');
            document.getElementById('endereco').value = membro['Endereço'] || '';
            document.getElementById('numero').value = membro['Número'] || '';
            document.getElementById('bairro').value = membro['Bairro'] || '';
            document.getElementById('cidade').value = membro['Cidade'] || '';
            document.getElementById('estado').value = membro['UF (Estado)'] || membro['UF'] || '';
            document.getElementById('cep').value = membro['CEP'] || '';
            document.getElementById('telefone1').value = membro['Telefone'] || '';
            document.getElementById('email').value = membro['E-mail'] || '';
            document.getElementById('formacao').value = membro['Formação'] || '';
            document.getElementById('profissao').value = membro['Profissão / Atividade Comercial'] || '';
            document.getElementById('dependente1').value = membro['Dependente 1 - Nome'] || '';
            document.getElementById('dependente2').value = membro['Dependente 2 - Nome'] || '';
            document.getElementById('dependente3').value = membro['Dependente 3 - Nome'] || '';
            document.getElementById('dependente4').value = membro['Dependente 4 - Nome'] || '';
            document.getElementById('data_nascimento_dependente1').value = formatarData(membro['Dependente 1 - Data de Nascimento'] || '');
            document.getElementById('data_nascimento_dependente2').value = formatarData(membro['Dependente 2 - Data de Nascimento'] || '');
            document.getElementById('data_nascimento_dependente3').value = formatarData(membro['Dependente 3 - Data de Nascimento'] || '');
            document.getElementById('data_nascimento_dependente4').value = formatarData(membro['Dependente 4 - Data de Nascimento'] || '');
            document.getElementById('data_novo_nascimento').value = formatarData(membro['Data do novo nascimento'] || '');
            document.getElementById('facebook').value = membro['Facebook'] || '';
            document.getElementById('instagram').value = membro['Instagram'] || '';
            document.getElementById('observacoes').value = membro['Observações Finais'] || '';
            
            // Radio buttons
            document.getElementById('masculino').checked = (membro['Gênero'] || '').toLowerCase().includes('masc');
            document.getElementById('feminino').checked = (membro['Gênero'] || '').toLowerCase().includes('fem');
            
            document.getElementById('empresario_sim').checked = (membro['É empresário?'] || '').toLowerCase().includes('sim');
            document.getElementById('empresario_nao').checked = (membro['É empresário?'] || '').toLowerCase().includes('não') || 
                                                              (membro['É empresário?'] || '').toLowerCase().includes('nao');
            
            document.getElementById('membro_casado_sim').checked = (membro['O cônjuge é membro da igreja?'] || '').toLowerCase().includes('sim');
            document.getElementById('membro_casado_nao').checked = (membro['O cônjuge é membro da igreja?'] || '').toLowerCase().includes('não') || 
                                                                 (membro['O cônjuge é membro da igreja?'] || '').toLowerCase().includes('nao');
            
            document.getElementById('rhema_sim').checked = (membro['Rhema'] || '').toLowerCase().includes('sim');
            document.getElementById('rhema_nao').checked = (membro['Rhema'] || '').toLowerCase().includes('não') || 
                                                         (membro['Rhema'] || '').toLowerCase().includes('nao');
            
            document.getElementById('emr_sim').checked = (membro['Escola de Ministros Rhema'] || '').toLowerCase().includes('sim');
            document.getElementById('emr_nao').checked = (membro['Escola de Ministros Rhema'] || '').toLowerCase().includes('não') || 
                                                       (membro['Escola de Ministros Rhema'] || '').toLowerCase().includes('nao');
            
            document.getElementById('ermm_sim').checked = (membro['Escola de Missões Rhema'] || '').toLowerCase().includes('sim');
            document.getElementById('ermm_nao').checked = (membro['Escola de Missões Rhema'] || '').toLowerCase().includes('não') || 
                                                        (membro['Escola de Missões Rhema'] || '').toLowerCase().includes('nao');
            
            document.getElementById('batismo_aguas_sim').checked = (membro['Já se batizou nas águas?'] || '').toLowerCase().includes('sim');
            document.getElementById('batismo_aguas_nao').checked = (membro['Já se batizou nas águas?'] || '').toLowerCase().includes('não') || 
                                                                 (membro['Já se batizou nas águas?'] || '').toLowerCase().includes('nao');
            
            document.getElementById('espirito_santo_sim').checked = (membro['Já recebeu o batismo no Espírito Santo?'] || '').toLowerCase().includes('sim');
            document.getElementById('espirito_santo_nao').checked = (membro['Já recebeu o batismo no Espírito Santo?'] || '').toLowerCase().includes('não') || (membro['Já recebeu o batismo no Espírito Santo?'] || '').toLowerCase().includes('nao');
           
            document.getElementById('aspersao').checked = (membro['Forma do batismo'] || '').toLowerCase().includes('aspersão') || (membro['Forma do batismo'] || '').toLowerCase().includes('aspersão');

            document.getElementById('imersao').checked = (membro['Forma do batismo'] || '').toLowerCase().includes('imersão') || (membro['Forma do batismo'] || '').toLowerCase().includes('imersão');

             // Atualiza o nome na assinatura
            
                const nomeMembro = document.getElementById('nome').value;
            document.getElementById('nome-assinatura').textContent = nomeMembro || '';
            

            

            // Selects
           
        }

        document.querySelectorAll('#funcionarioForm input, #funcionarioForm textarea').forEach(el => {
        if (el.id !== 'selecionarMembro') {
            el.classList.add('input-readonly');
        }
    });

        
        // Adiciona event listeners quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('fileInput').addEventListener('change', carregarPlanilha);
            document.getElementById('selecionarMembro').addEventListener('change', preencherCampos);
        });


         // Adiciona antes do fechamento </body>
    window.onbeforeprint = function() {
        document.body.style.margin = "0";
        document.body.style.padding = "0";
        document.body.style.transform = "scale(1)";
        
        // Cria um elemento temporário para forçar a limpeza
        const cleanPrint = document.createElement('style');
        cleanPrint.id = 'clean-print';
        cleanPrint.innerHTML = `
            @page { margin: 2mm; size: auto; }
            body { margin: 10mm !important; }
        `;
        document.head.appendChild(cleanPrint);
    };

    window.onafterprint = function() {
        // Remove o estilo após impressão
        const style = document.getElementById('clean-print');
        if (style) style.remove();
    };


    
    </script>
</body>
</html>
